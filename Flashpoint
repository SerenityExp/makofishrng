-- LocalScript inside StarterPlayerScripts

--// Setup
local plr = game.Players.LocalPlayer
local uis = game:GetService("UserInputService")
local rs = game:GetService("RunService")

-- Colors
local LAVENDER = Color3.fromRGB(200,180,255)
local DARK1 = Color3.fromRGB(20,20,20)
local DARK2 = Color3.fromRGB(30,30,30)
local DARK3 = Color3.fromRGB(40,40,40)

--// ScreenGui
local gui = Instance.new("ScreenGui")
gui.Name = "AdvancedSpeedGUI"
gui.Parent = plr:WaitForChild("PlayerGui")
gui.ResetOnSpawn = false

--// Main Frame
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 280, 0, 60)
mainFrame.Position = UDim2.new(0.05, 0, 0.2, 0)
mainFrame.BackgroundColor3 = DARK1
mainFrame.BorderSizePixel = 0
mainFrame.Active = true
mainFrame.Draggable = true -- draggable gui
mainFrame.Parent = gui
Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 12)

--// Topbar
local topBar = Instance.new("Frame")
topBar.Size = UDim2.new(1, 0, 0, 40)
topBar.BackgroundColor3 = DARK2
topBar.Parent = mainFrame
Instance.new("UICorner", topBar).CornerRadius = UDim.new(0, 12)

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -90, 1, 0)
title.Position = UDim2.new(0, 10, 0, 0)
title.BackgroundTransparency = 1
title.Text = "Speed GUI"
title.Font = Enum.Font.GothamBold
title.TextSize = 18
title.TextColor3 = LAVENDER
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = topBar

-- Fullscreen + Minimize buttons
local fullBtn = Instance.new("TextButton")
fullBtn.Size = UDim2.new(0, 30, 0, 30)
fullBtn.Position = UDim2.new(1, -70, 0.5, -15)
fullBtn.Text = "⬜"
fullBtn.Font = Enum.Font.GothamBold
fullBtn.TextSize = 18
fullBtn.TextColor3 = LAVENDER
fullBtn.BackgroundColor3 = DARK3
fullBtn.Parent = topBar
Instance.new("UICorner", fullBtn).CornerRadius = UDim.new(0, 6)

local minBtn = Instance.new("TextButton")
minBtn.Size = UDim2.new(0, 30, 0, 30)
minBtn.Position = UDim2.new(1, -35, 0.5, -15)
minBtn.Text = "—"
minBtn.Font = Enum.Font.GothamBold
minBtn.TextSize = 18
minBtn.TextColor3 = LAVENDER
minBtn.BackgroundColor3 = DARK3
minBtn.Parent = topBar
Instance.new("UICorner", minBtn).CornerRadius = UDim.new(0, 6)

-- Content Frame
local content = Instance.new("Frame")
content.Size = UDim2.new(1, -20, 0, 0)
content.Position = UDim2.new(0, 10, 0, 50)
content.BackgroundTransparency = 1
content.Visible = true
content.Parent = mainFrame
content.AutomaticSize = Enum.AutomaticSize.Y

local listLayout = Instance.new("UIListLayout")
listLayout.Parent = content
listLayout.Padding = UDim.new(0, 6)

-- Dropdown helper
local function makeDropdown(name, options)
    local holder = Instance.new("Frame")
    holder.Size = UDim2.new(1,0,0,0)
    holder.AutomaticSize = Enum.AutomaticSize.Y
    holder.BackgroundTransparency = 1
    holder.Parent = content

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 0, 35)
    frame.BackgroundColor3 = DARK2
    frame.Parent = holder
    Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 8)

    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, 0, 1, 0)
    btn.BackgroundTransparency = 1
    btn.Text = name.." ▼"
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 16
    btn.TextColor3 = LAVENDER
    btn.Parent = frame

    local dropFrame = Instance.new("Frame")
    dropFrame.Size = UDim2.new(1, 0, 0, 0)
    dropFrame.BackgroundColor3 = DARK1
    dropFrame.ClipsDescendants = true
    dropFrame.Visible = false
    dropFrame.Parent = holder
    dropFrame.AutomaticSize = Enum.AutomaticSize.Y
    Instance.new("UICorner", dropFrame).CornerRadius = UDim.new(0, 8)

    local layout = Instance.new("UIListLayout", dropFrame)
    layout.Padding = UDim.new(0, 4)

    local selected = options[1]
    for _, op in ipairs(options) do
        local b = Instance.new("TextButton")
        b.Size = UDim2.new(1, 0, 0, 25)
        b.BackgroundColor3 = DARK3
        b.Text = op
        b.Font = Enum.Font.Gotham
        b.TextSize = 14
        b.TextColor3 = LAVENDER
        b.Parent = dropFrame
        Instance.new("UICorner", b).CornerRadius = UDim.new(0, 6)

        b.MouseButton1Click:Connect(function()
            selected = op
            btn.Text = name.." ("..op..") ▼"
            dropFrame.Visible = false
            mainFrame.Size = UDim2.new(0,280,0,content.AbsoluteSize.Y+60)
        end)
    end

    local open = false
    btn.MouseButton1Click:Connect(function()
        open = not open
        dropFrame.Visible = open
        mainFrame.Size = UDim2.new(0,280,0,content.AbsoluteSize.Y+60)
    end)

    return function() return selected end
end

-- Dropdowns
local getMethod = makeDropdown("Speed Method", {"WalkSpeed","CFrame","BodyVelocity","HRP Velocity"})
local getInputType = makeDropdown("Input Mode", {"Slider","NumberBox"})

-- Slider + NumberBox holder
local valueFrame = Instance.new("Frame")
valueFrame.Size = UDim2.new(1,0,0,0)
valueFrame.AutomaticSize = Enum.AutomaticSize.Y
valueFrame.BackgroundTransparency = 1
valueFrame.Parent = content

-- Slider
local sliderFrame = Instance.new("Frame")
sliderFrame.Size = UDim2.new(1, 0, 0, 35)
sliderFrame.BackgroundColor3 = DARK2
sliderFrame.Parent = valueFrame
Instance.new("UICorner", sliderFrame).CornerRadius = UDim.new(0,8)

local sliderBar = Instance.new("Frame")
sliderBar.Size = UDim2.new(0.8, 0, 0.3, 0)
sliderBar.Position = UDim2.new(0.1,0,0.35,0)
sliderBar.BackgroundColor3 = DARK3
sliderBar.Parent = sliderFrame
Instance.new("UICorner", sliderBar).CornerRadius = UDim.new(0,8)

local fillBar = Instance.new("Frame")
fillBar.Size = UDim2.new(0,0,1,0)
fillBar.BackgroundColor3 = LAVENDER
fillBar.Parent = sliderBar
Instance.new("UICorner", fillBar).CornerRadius = UDim.new(0,8)

local sliderValue = 100
local dragging = false
sliderBar.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then dragging = true end end)
uis.InputEnded:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end end)
uis.InputChanged:Connect(function(i)
    if dragging and i.UserInputType == Enum.UserInputType.MouseMovement then
        local rel = math.clamp((i.Position.X - sliderBar.AbsolutePosition.X)/sliderBar.AbsoluteSize.X,0,1)
        fillBar.Size = UDim2.new(rel,0,1,0)
        sliderValue = math.floor(rel*20000)
    end
end)

-- NumberBox
local inputBox = Instance.new("TextBox")
inputBox.Size = UDim2.new(0, 80, 0, 28)
inputBox.Position = UDim2.new(0.5, -38, 0.5, -14)
inputBox.Text = "100"
inputBox.Visible = false
inputBox.Font = Enum.Font.Gotham
inputBox.TextSize = 14
inputBox.TextColor3 = LAVENDER
inputBox.BackgroundColor3 = DARK3
inputBox.Parent = valueFrame
Instance.new("UICorner", inputBox).CornerRadius = UDim.new(0,6)

inputBox.FocusLost:Connect(function()
    local v = tonumber(inputBox.Text)
    if v then
        v = math.clamp(v,0,150000)
        sliderValue = v
        inputBox.Text = tostring(v)
    end
end)

-- Enable Speed toggle
local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(1, 0, 0, 35)
toggleBtn.BackgroundColor3 = DARK3
toggleBtn.Text = "Enable: OFF"
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextSize = 16
toggleBtn.TextColor3 = LAVENDER
toggleBtn.Parent = content
Instance.new("UICorner", toggleBtn).CornerRadius = UDim.new(0, 8)

local enabled = false
toggleBtn.MouseButton1Click:Connect(function()
    enabled = not enabled
    toggleBtn.Text = "Enable: "..(enabled and "ON" or "OFF")
    toggleBtn.BackgroundColor3 = enabled and LAVENDER or DARK3
    toggleBtn.TextColor3 = enabled and DARK1 or LAVENDER
end)

-- Instant Stop button
local stopBtn = Instance.new("TextButton")
stopBtn.Size = UDim2.new(1, 0, 0, 35)
stopBtn.BackgroundColor3 = DARK3
stopBtn.Text = "Instant Stop: OFF"
stopBtn.Font = Enum.Font.GothamBold
stopBtn.TextSize = 16
stopBtn.TextColor3 = LAVENDER
stopBtn.Parent = content
Instance.new("UICorner", stopBtn).CornerRadius = UDim.new(0, 8)

local instantStopEnabled = false
stopBtn.MouseButton1Click:Connect(function()
    instantStopEnabled = not instantStopEnabled
    stopBtn.Text = "Instant Stop: " .. (instantStopEnabled and "ON" or "OFF")
    stopBtn.BackgroundColor3 = instantStopEnabled and LAVENDER or DARK3
    stopBtn.TextColor3 = instantStopEnabled and DARK1 or LAVENDER
end)

-- Keybind for instant stop
local keyLabel = Instance.new("TextButton")
keyLabel.Size = UDim2.new(1, 0, 0, 24)
keyLabel.BackgroundColor3 = DARK2
keyLabel.Text = "Key: X"
keyLabel.Font = Enum.Font.Gotham
keyLabel.TextSize = 13
keyLabel.TextColor3 = LAVENDER
keyLabel.Parent = content
Instance.new("UICorner", keyLabel).CornerRadius = UDim.new(0,6)

local instantStopKey = Enum.KeyCode.X
local waitingForKey = false
keyLabel.MouseButton1Click:Connect(function()
    keyLabel.Text = "Press Key..."
    waitingForKey = true
end)

uis.InputBegan:Connect(function(input, gpe)
    if gpe then return end
    if waitingForKey and input.UserInputType == Enum.UserInputType.Keyboard then
        instantStopKey = input.KeyCode
        keyLabel.Text = "Key: " .. input.KeyCode.Name
        waitingForKey = false
    elseif instantStopEnabled and input.KeyCode == instantStopKey then
        if plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            local hrp = plr.Character.HumanoidRootPart
            hrp.Velocity = Vector3.zero
            hrp.RotVelocity = Vector3.zero
            local bv = hrp:FindFirstChild("SpeedBV")
            if bv then bv.Velocity = Vector3.zero end
        end
    end
end)

--// Speed application
rs.RenderStepped:Connect(function()
    if not enabled then return end
    local char = plr.Character
    if not char then return end
    local hum = char:FindFirstChildOfClass("Humanoid")
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hum or not hrp then return end

    local spd = sliderValue
    if getInputType()=="NumberBox" then
        local v = tonumber(inputBox.Text)
        if v then spd = math.clamp(v,0,150000) end
    end

    local method = getMethod()
    if method=="WalkSpeed" then
        hum.WalkSpeed = spd/10
    elseif method=="CFrame" then
        if hum.MoveDirection.Magnitude > 0 then
            hrp.CFrame = hrp.CFrame + hum.MoveDirection * (spd/500)
        end
    elseif method=="BodyVelocity" then
        local bv = hrp:FindFirstChild("SpeedBV") or Instance.new("BodyVelocity")
        bv.Name = "SpeedBV"
        bv.MaxForce = Vector3.new(1,0,1)*1e5
        bv.Velocity = hum.MoveDirection * (spd/10)
        bv.Parent = hrp
    elseif method=="HRP Velocity" then
        hrp.Velocity = hum.MoveDirection * (spd/10)
    end
end)

--// Minimize & Fullscreen
local minimized = false
local fullscreen = false

minBtn.MouseButton1Click:Connect(function()
    minimized = not minimized
    if minimized then
        content.Visible = false
        mainFrame.Size = UDim2.new(0, 300, 0, 50)
        fullBtn.Active = false
        fullBtn.AutoButtonColor = false
    else
        content.Visible = true
        mainFrame.Size = UDim2.new(0, 280, 0, content.AbsoluteSize.Y+60)
        fullBtn.Active = true
        fullBtn.AutoButtonColor = true
    end
end)

fullBtn.MouseButton1Click:Connect(function()
    if minimized then return end
    fullscreen = not fullscreen
    if fullscreen then
        mainFrame.Size = UDim2.new(0.6,0,0.7,0)
    else
        mainFrame.Size = UDim2.new(0,280,0,content.AbsoluteSize.Y+60)
    end
end)

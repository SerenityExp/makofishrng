--[[ ==============================================================
     ALT‑CONTROL SCRIPT – FINAL VERSION
     • .summon  → hover (collisions OFF)
     • .vanish  → underground (collisions OFF)
     • .fling   → TP spam + fling loop (collisions ON)
     • .tweak   → spin on ground, speed increases
     • .stop    → stop everything
   ============================================================== ]]

local Players      = game:GetService("Players")
local RunService   = game:GetService("RunService")
local LocalPlayer  = Players.LocalPlayer

--// STATE ---------------------------------------------------------
local MainAccount   = nil
local IsSummoning   = false
local IsVanishing   = false
local IsFlinging    = false
local IsTweaking    = false
local FlingTarget   = nil
local ChatConn      = nil
local TweakSpeed    = 0

--// UTILS ---------------------------------------------------------
local function StopEverything()
    IsSummoning = false; IsVanishing = false; IsFlinging = false; IsTweaking = false
    FlingTarget = nil; TweakSpeed = 0

    local char = LocalPlayer.Character
    if char and char:FindFirstChildOfClass("Humanoid") then
        local hum = char.Humanoid
        hum.WalkSpeed = 16
        hum.JumpPower = 50
        hum.Sit = false
    end

    if char then
        for _, v in ipairs(char:GetDescendants()) do
            if v:IsA("BasePart") then
                v.CanCollide = true
                v.CanTouch   = true
            end
        end
    end
    print("[ALT] Stopped all actions")
end

local function NoCollide(char, bool)
    for _, v in ipairs(char:GetDescendants()) do
        if v:IsA("BasePart") then
            v.CanCollide = bool
            v.CanTouch   = bool
        end
    end
end

--// HOVER RIG (used by summon & vanish) -------------------------
local function HoverRig(altHRP, targetHRP, offset)
    for _, v in ipairs(altHRP:GetChildren()) do
        if v:IsA("AlignPosition") or v:IsA("AlignOrientation") then v:Destroy() end
    end

    local att0 = Instance.new("Attachment", altHRP)
    local att1 = Instance.new("Attachment")

    local ap = Instance.new("AlignPosition", altHRP)
    ap.MaxForce        = 1/0
    ap.Responsiveness  = 200
    ap.RigidityEnabled = true
    ap.Attachment0     = att0
    ap.Attachment1     = att1

    local ao = Instance.new("AlignOrientation", altHRP)
    ao.MaxTorque       = 1/0
    ao.Responsiveness  = 200
    ao.RigidityEnabled = true
    ao.Attachment0     = att0
    ao.Attachment1     = att1

    return task.spawn(function()
        while (IsSummoning or IsVanishing) and targetHRP and targetHRP.Parent do
            att1.Parent = targetHRP
            att1.CFrame = CFrame.new(offset)
            RunService.Heartbeat:Wait()
        end
        ap:Destroy(); ao:Destroy(); att1:Destroy(); att0:Destroy()
    end)
end

--// .summon -------------------------------------------------------
local function Summon()
    StopEverything()
    if not MainAccount or not MainAccount.Character then warn("[ALT] No main selected"); return end

    local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local altHRP  = char:FindFirstChild("HumanoidRootPart")
    local mainHRP = MainAccount.Character:FindFirstChild("HumanoidRootPart")
    if not (altHRP and mainHRP) then return end

    IsSummoning = true
    char.Humanoid.WalkSpeed = 0
    char.Humanoid.JumpPower = 0
    NoCollide(char, false)  -- OFF during summon
    HoverRig(altHRP, mainHRP, Vector3.new(5, 6, 0))
    print("[ALT] Summoned – hovering (no collision)")
end

--// .vanish -------------------------------------------------------
local function Vanish()
    StopEverything()
    if not MainAccount or not MainAccount.Character then warn("[ALT] No main selected"); return end

    local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local altHRP  = char:FindFirstChild("HumanoidRootPart")
    local mainHRP = MainAccount.Character:FindFirstChild("HumanoidRootPart")
    if not (altHRP and mainHRP) then return end

    IsVanishing = true
    char.Humanoid.WalkSpeed = 0
    char.Humanoid.JumpPower = 0
    NoCollide(char, false)  -- OFF during vanish
    HoverRig(altHRP, mainHRP, Vector3.new(0, -30, 0))
    print("[ALT] Vanished – 30 studs under (no collision)")
end

--// .fling <DisplayName> -----------------------------------------
local function StartFling(displayName)
    StopEverything()
    local target = nil
    for _, p in ipairs(Players:GetPlayers()) do
        if p.DisplayName:lower() == displayName:lower() then target = p; break end
    end
    if not target then warn("[ALT] Player not found:", displayName); return end

    FlingTarget = target
    IsFlinging  = true
    local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    NoCollide(char, true)  -- COLLISIONS ON during fling

    -- 0.1s TP spam
    task.spawn(function()
        while IsFlinging do
            local lpHRP = char:FindFirstChild("HumanoidRootPart")
            local tgtHRP = target.Character and target.Character:FindFirstChild("HumanoidRootPart")
            if lpHRP and tgtHRP then
                lpHRP.CFrame = tgtHRP.CFrame * CFrame.new(0,0,-1)
            end
            task.wait(0.1)
        end
    end)

    -- hidden-fling loop
    task.spawn(function()
        local c, hrp, vel, movel = nil, nil, nil, 0.1
        while IsFlinging do
            RunService.Heartbeat:Wait()
            c   = LocalPlayer.Character
            hrp = c and c:FindFirstChild("HumanoidRootPart")
            if hrp then
                vel = hrp.Velocity
                hrp.Velocity = vel * 10000 + Vector3.new(0, 10000, 0)
                RunService.RenderStepped:Wait()
                hrp.Velocity = vel
                RunService.Stepped:Wait()
                hrp.Velocity = vel + Vector3.new(0, movel, 0)
                movel = -movel
            else
                break
            end
        end
    end)

    print("[ALT] Flinging ->", target.DisplayName, "(collisions ON)")
end

--// .tweak – spin on ground, faster over time --------------------
local function Tweak()
    StopEverything()
    local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    IsTweaking = true
    TweakSpeed = 100

    -- Keep on ground
    task.spawn(function()
        while IsTweaking do
            if hrp and hrp.Parent then
                local pos = hrp.Position
                hrp.CFrame = CFrame.new(pos.X, pos.Y, pos.Z) * CFrame.Angles(0, math.rad(TweakSpeed), 0)
                TweakSpeed = TweakSpeed + 15  -- accelerate
            end
            RunService.Heartbeat:Wait()
        end
    end)

    print("[ALT] Tweak started – spinning faster...")
end

--// OTHER COMMANDS ------------------------------------------------
local function Teleport()
    StopEverything()
    if not MainAccount or not MainAccount.Character then return end
    local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local altHRP  = char:FindFirstChild("HumanoidRootPart")
    local mainHRP = MainAccount.Character:FindFirstChild("HumanoidRootPart")
    if altHRP and mainHRP then
        altHRP.CFrame = mainHRP.CFrame + Vector3.new(0,5,0)
        print("[ALT] Teleported")
    end
end

local function Jump()
    local hum = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
    if hum then hum.Jump = true end
end

local function Sit()
    local hum = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
    if hum then hum.Sit = true end
end

local function Fall()
    LocalPlayer.Character:BreakJoints()
end

--// CHAT HANDLER --------------------------------------------------
local function OnChat(msg)
    msg = msg:lower():gsub("^%s*(.-)%s*$", "%1")

    if msg == ".summon" then Summon()
    elseif msg == ".vanish" then Vanish()
    elseif msg == ".tp" then Teleport()
    elseif msg == ".stop" then StopEverything()
    elseif msg == ".jump" then Jump()
    elseif msg == ".sit" then Sit()
    elseif msg == ".fall" then Fall()
    elseif msg == ".tweak" then Tweak()
    elseif msg:find("^%.fling ") then
        local name = msg:match("^%.fling%s+(.+)")
        if name then StartFling(name) end
    end
end

--// UI – PICK MAIN ACCOUNT ----------------------------------------
local function BuildUI()
    local sg = Instance.new("ScreenGui", game:GetService("CoreGui"))
    sg.Name = "AltControlUI"
    local frame = Instance.new("Frame", sg)
    frame.Size = UDim2.new(0,200,0,300)
    frame.Position = UDim2.new(0,10,0,10)
    frame.BackgroundColor3 = Color3.fromRGB(30,30,30)

    local layout = Instance.new("UIListLayout", frame)

    local function addBtn(pl)
        local btn = Instance.new("TextButton", frame)
        btn.Size = UDim2.new(1,0,0,30)
        btn.Text = pl.Name
        btn.BackgroundColor3 = Color3.fromRGB(50,50,50)
        btn.TextColor3 = Color3.new(1,1,1)
        btn.MouseButton1Click:Connect(function()
            MainAccount = pl
            if ChatConn then ChatConn:Disconnect() end
            ChatConn = pl.Chatted:Connect(OnChat)
            print("[ALT] Main set →", pl.Name)
        end)
    end

    for _, pl in ipairs(Players:GetPlayers()) do
        if pl ~= LocalPlayer then addBtn(pl) end
    end

    Players.PlayerAdded:Connect(function(pl)
        if pl ~= LocalPlayer then addBtn(pl) end
    end)
end

BuildUI()
